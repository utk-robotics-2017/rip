<appendage-template>
    <includes>
        <include standard="true">NewPing.h</include>
    </includes>
    <constructors>
        <constructor type="NewPing" variable="sonar">
            <argument type="int" name="triggerPin" />
            <argument type="int" name="echoPin" />
            <argument type="int" name="maxDistance" value="200" />
        </constructor>
        <constructor type="int" variable="sonar_timeouts">
            <argument type="int" name="minSleepMs" />
        </constructor>
        <constructor type="long" variable="sonar_prevtime">
            <argument type="long" name="timeSinceLastRead" value="1" />
        </constructor>
        <constructor type="int" variable="sonar_ping_medians">
            <argument type="int" name="ping_median" value="5" />
        </constructor>
    </constructors>
    <setup>
        // Ultrasonic triggerPin: $triggerPin$
    </setup>
    <loop>
        // Ultrasonic echoPin: $echoPin$
    </loop>
    <commands>
        <command id="kReadUltrasonic" name="readUltraSonic" index-num="true">
            <return-value name="rv" type="unsigned long"/>
            <code>
                unsigned long curtime = millis();
                if (curtime < sonar_prevtime[indexNum]+sonar_timeouts[indexNum])
                {
                    delay(sonar_prevtime[indexNum]+sonar_timeouts[indexNum] - curtime );
                }
                //rv = sonar[indexNum].ping_cm();
                unsigned long median_time = sonar[indexNum].ping_median(sonar_ping_medians[indexNum]);
                rv = NewPing::convert_cm(median_time);
                sonar_prevtime[indexNum] = millis();
            </code>
        </command>
    </commands>
</appendage-template>
