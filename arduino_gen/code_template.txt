// Auto-generated by ArduinoGen

#include "CmdMessenger.h"
{includes}

// Attach a new CmdMessenger object to the default Serial port
CmdMessenger cmdMessenger = CmdMessenger(Serial);

const char LED = 13;

{constructors}

enum class Commands
{{
	kAcknowledge,
	kError,
	kUnknown,
	kSetLed,
	kPing,
	kPingResult,
	kPong,
{command_enums}
}};

void setup()
{{
	// Init LED pin
	pinMode(LED, OUTPUT);

	// Initialize Serial Communication
	Serial.begin(115200);

	attachCommandCallbacks();

{setup}

	// Flash led 3 times at the end of setup
	for(int i = 0; i < 3; i++)
	{{
		digitalWrite(LED, HIGH);
		delay(250);
		digitalWrite(LED, LOW);
		delay(250);
	}}
}}

void loop()
{{
	// Process incoming serial data, and perform callbacks
	cmdMessenger.feedinSerialData();

{loop}
}}

//Callbacks define on which received commands we take action
void attachCommandCallbacks()
{{
	cmdMessenger.attach(unknownCommand);
	cmdMessenger.attach(Commands::kPing, ping);
	cmdMessenger.attach(Commands::kSetLed, setLed);
{command_attaches}
}}

// Called when a received command has no attached function
void unknownCommand()
{{
	cmdMessenger.sendCmd(Commands::kError, Commands::kUnknown);
}}

// Called upon initialization of Spine to check connection
void ping()
{{
	cmdMessenger.sendBinCmd(Commands::kAcknowledge, Commands::kPing);
	cmdMessenger.sendBinCmd(Commands::kPingResult, Commands::kPong);
}}

// Callback function that sets led on or off
void setLed()
{{
	// Read led state argument, interpret string as boolean
	bool ledState = cmdMessenger.readBoolArg();
	digitalWrite(LED, ledState);
	cmdMessenger.sendBinCmd(Commands::kAcknowledge, Commands::kSetLed);
}}

{command_callbacks}

{extra}
